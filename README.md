```markdown
# 施設見学会リマインド＆通知システム

## 📌 システム概要と目的

### 🎯 目的
このシステムは、**施設見学会の参加者に対してリマインドメールを自動作成し、同時にSlackへ通知** することで、手動での連絡作業の負担を大幅に軽減することを目的としています。

✅ **Googleフォームの回答をトリガーに、スプレッドシートのデータをもとにSlack通知とGmailの下書き作成を自動化**  
✅ **確認漏れ・送信遅延・ヒューマンエラーを防止し、業務効率を向上**  

### ⚠ 背景・課題
- **⏳ 手作業による連絡の手間**：  
  各参加者へ個別にメールを作成・送信するため、確認漏れや送信遅延が発生。  
- **💥 ヒューマンエラーの防止**：  
  メール文面のコピペミス、通知忘れなどが頻繁に発生。  
- **🚀 業務効率の向上**：  
  多数の見学会予約に対して、迅速かつ正確な連絡が求められる。

---

## 🔧 システムの詳細な機能と処理フロー

### 1️⃣ Slack通知機能 (`sendSlackNotification`)
📌 **処理の流れ**  
1. **トリガー設定**  
   - Googleフォームの回答をトリガーに、スプレッドシートの最新行のデータを取得。  
   - 重複トリガーの削除を行い、最新の設定で動作。  
2. **データ取得と検証**  
   - 「見学会テスト」シートの最新行データを取得し、通知対象かをチェック。  
3. **メッセージ構築**  
   - 見学会情報を整形し、Slack通知用のメッセージを作成（Markdownエスケープ処理含む）。  
4. **Slackへの送信**  
   - SlackのWebhook URLを使ってメッセージをPOSTリクエストで送信。  
   - 通知後はJ列に通知済みフラグを更新し、二重通知を防止。  

```javascript
function sendSlackNotification(message) {
  const webhookUrl = "https://hooks.slack.com/services/xxxx";
  const payload = JSON.stringify({ text: message });
  UrlFetchApp.fetch(webhookUrl, { method: "post", contentType: "application/json", payload: payload });
}
```

---

### 2️⃣ リマインドメール下書き作成 (`sendEmail`)
📌 **処理の流れ**  
1. **対象データのループ処理**  
   - スプレッドシートの各行をループし、送信済みフラグをチェック。  
   - 名前やメールアドレスがあるか、簡易バリデーションを実施。  
2. **メール本文の作成**  
   - 見学会の日程・参加者名を抽出し、独自の関数で日付フォーマット処理。  
   - Gmailの下書きを自動作成。  
3. **フラグ更新**  
   - 下書き作成後、該当行の通知済みフラグを更新し、再処理を防止。  

```javascript
function sendEmail(recipient, subject, body) {
  const draft = GmailApp.createDraft(recipient, subject, body);
  Logger.log("Draft created for: " + recipient);
}
```

---

## 🚀 技術的工夫とチャレンジ
- **📌 Google Apps Script(GAS)を活用したリアルタイム自動化**  
  - Googleフォーム・スプレッドシートと連携し、即時処理を実現。  
- **📌 Slack API & Gmail APIの統合**  
  - Webhookを活用してSlack通知を実装し、Gmailの下書きを自動生成。  
- **📌 柔軟なデータ抽出 & 文字列処理**  
  - Markdownエスケープ処理、カスタム日付解析関数でフォーマットの統一。  
- **📌 エラーハンドリング & ログ管理**  
  - エラー発生時にログ出力し、運用時のトラブルシュートを容易に。  

---

## 🏆 業務改善の成果
✅ **作業時間の短縮**  
　手動でのメール作成・通知作業を自動化し、工数を大幅削減！  

✅ **正確性の向上**  
　転記ミス・通知忘れをゼロにし、確実な情報共有を実現。  

✅ **業務プロセスの標準化**  
　誰が作業しても、一定品質での通知・連絡が可能に。  

---

## 🎯 ターゲットユーザー & 今後の展望
### 👥 **対象ユーザー**
- **施設運営・イベント担当者**  
- **見学会の予約管理を行う部署**  
- **多数の参加者への通知作業を効率化したい企業・団体**  

### 🔮 **今後の展望**
✅ **SMS・LINEなど他の通知手段と連携**  
✅ **下書きメールの自動送信機能の追加**  
✅ **ダッシュボードで運用状況の可視化 & レポート機能の強化**  

---

## 🔍 まとめ
「**施設見学会リマインド＆通知システム**」は、  
**Google Apps Script を活用し、Slack通知 & Gmail下書き作成を完全自動化** したシステムです。

🎯 **作業時間削減** × **通知ミス防止** × **業務の効率化**  
✨ **簡単 & 高速な運用で、施設管理の負担を大幅に軽減！**  
```
